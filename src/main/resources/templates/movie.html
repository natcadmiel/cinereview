<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{base :: layout(~{::content})}">
<div th:fragment="content">
    <div class="movie-header" style="display: flex; gap: 40px; align-items: flex-start;">
        <img th:if="${filme.imagem != null && !filme.imagem.isEmpty()}" th:src="${filme.imagem}"
            th:alt="${filme.titulo}" style="width: 300px; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.5);">
        <div style="flex-grow: 1;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <h1 style="color: var(--primary-color); font-size: 3rem; margin-bottom: 0.5rem; margin-top: 0;"
                    th:text="${filme.titulo}">Título</h1>

                <div
                    th:if="${currentUser != null && filme.user != null && currentUser.username == filme.user.username}">
                    <a th:href="@{/editar/{id}(id=${filme.id})}" class="btn-edit">Editar</a>
                    <form th:action="@{/excluir/{id}(id=${filme.id})}" method="post" style="display:inline;">
                        <button type="submit" class="btn-delete">Excluir</button>
                    </form>
                </div>
            </div>
            <span
                style="font-size: 1.2rem; color: var(--text-muted); background: #333; padding: 2px 8px; border-radius: 4px;"
                th:text="${filme.ano}">Ano</span>
            <p style="margin-top: 20px; font-size: 1.1rem; max-width: 800px; color: #ddd;" th:text="${filme.descricao}">
                Descrição</p>
        </div>
    </div>

    <div class="reviews-section">
        <div class="form-container" style="margin: 0; max-width: 100%;">
            <h3>Deixe sua Avaliação</h3>
            <form th:action="@{/filme/{id}/adicionar_avaliacao(id=${filme.id})}" method="POST">
                <div class="form-group">
                    <div class="form-group">
                        <label for="user_name">Seu Nome</label>
                        <input type="text" id="user_name" name="user_name"
                            th:value="${currentUser != null ? currentUser.username : ''}"
                            th:readonly="${currentUser != null}" required>
                    </div>
                    <div class="form-group">
                        <label for="rating">Nota (1-5)</label>
                        <select id="rating" name="rating" required>
                            <option value="5">5 - Excelente</option>
                            <option value="4">4 - Muito Bom</option>
                            <option value="3">3 - Bom</option>
                            <option value="2">2 - Regular</option>
                            <option value="1">1 - Ruim</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="comment">Comentário</label>
                        <textarea id="comment" name="comment" rows="3" required></textarea>
                    </div>
                    <button type="submit" class="btn-primary">Enviar Avaliação</button>
            </form>
        </div>

        <h2 style="margin-top: 40px; margin-bottom: 20px;">Avaliações de Usuários</h2>
        <div class="review-list">
            <div th:if="${#lists.isEmpty(avaliacoes)}">
                <p style="color: var(--text-muted);">Nenhuma avaliação ainda. Seja o primeiro!</p>
            </div>
            <div th:each="avaliacao : ${avaliacoes}" class="review-card">
                <div class="review-header">
                    <span style="color: var(--primary-color);" th:text="${avaliacao.nomeUsuario}">Usuário</span>
                    <span class="star-rating">
                        <span th:each="i : ${#numbers.sequence(1, avaliacao.nota)}">★</span><span
                            th:if="${avaliacao.nota < 5}" style="color: #444;"
                            th:each="i : ${#numbers.sequence(1, 5 - avaliacao.nota)}">★</span>
                    </span>
                </div>
                <p th:text="${avaliacao.comentario}">Comentário</p>
            </div>
        </div>
    </div>
</div>

</html>